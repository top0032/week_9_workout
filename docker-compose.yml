version: '3.8'

services:
  # 1. API 서비스 (Dockerfile 빌드)
  api:
    build:
      context: ./api  # 'api' 폴더의 Dockerfile을 사용
    container_name: capstone-api
    restart: unless-stopped
    networks:
      - capstone-net
    # 'api' 서비스는 내부적으로 5000번 포트에서 실행됩니다.

  # 2. Web 서비스 (Nginx 이미지 + Volume 마운트)
  web:
    image: nginx:alpine  # (수정) 공식 Nginx 이미지를 바로 사용
    container_name: capstone-web
    restart: unless-stopped
    ports:
      - "8080:80" # 사용자는 localhost:8080으로 접속
    
    # (수정) build 대신 volumes를 사용
    volumes:
      # 1. 로컬의 nginx.conf 파일을 -> 컨테이너의 Nginx 설정 파일로 덮어쓰기
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf
      # 2. 로컬의 index.html 파일을 -> 컨테이너의 웹 루트 폴더로 연결
      - ./nginx/html:/usr/share/nginx/html
    
    networks:
      - capstone-net
    depends_on: # api가 먼저 실행되도록 순서 보장
      - api          

networks:
  capstone-net:
    driver: bridge